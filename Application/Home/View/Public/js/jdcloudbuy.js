$(function(){$(".haveborder").mouseenter(function(){$(this).find(".title").css("background-color","#60aff6");$(this).find(".title span").css("color","#fff")});$(".haveborder").mouseleave(function(){$(this).find(".title").css("background-color","#ddd");$(this).find(".title span").css("color","#888")});$(window).scroll(function(){var docheight=$(window).height();var trpircetop=$("#tr-pirce").offset().top-$(window).scrollTop();if(trpircetop+90<docheight){$(".price-fix").hide()}else{$(".price-fix").show()}});var onthis=function(cthis){cthis.closest(".list").find("li").removeClass("onthis");cthis.addClass("onthis")};var getimagelist=function(){var imagesource=$(".imagetypeul").find(".onthis").data("val");var platform=$(".sel-os").children("option:selected").val();var regionid=$(".localul").find(".onthis").data("val");$(".spandding").show();$.post("getimage",{"regionid":regionid,"imagesource":imagesource,"platform":platform},function(data,status){data=JSON.parse(data);var images=data["msg"]["result"]["images"];if(images!=null){var options="";for(var i=0;i<images.length;i++){options+="<option value="+images[i]["imageId"]+">"+images[i]["name"]+"</option>"}$(".sel-images").html(options);getstandard();$(".spandding").hide()}else{$(".sel-images").html('<option value="">暂无镜像</option>');getstandard();$(".spandding").hide()}})};var getstandard=function(){var keyword="";var regionidid=$(".localul").find(".onthis").data("val");$(".currency").html('<tr><td colspan="4" style="height: 140px;vertical-align: middle;text-align: center;"><img src="__ASSETS__/images/loading.gif" height="25px;"></td></tr>');$.post("getstandard",{"keyword":keyword,"regionidid":regionidid},function(data,status){data=JSON.parse(data);var standards=data["msg"]["result"]["instanceTypes"];if(standards!=null){var currency_tr="",calculate_tr="",memory_tr="";var pubobj={"g.n":"通用 标准型","g.s":"通用 共享型"};for(var i=0;i<standards.length;i++){if(standards[i]["family"]=="g.n"||standards[i]["family"]=="g.s"){if(standards[i]["state"][0]["inStock"]==false){currency_tr+='<tr class=""><td class=""><label><input type="radio" name="instancetype" disabled value="'+standards[i]["instanceType"]+'">'+" "+pubobj[standards[i]["family"]]+'<span class="label label-default">售罄</span></label></td><td class="">'+standards[i]["instanceType"]+'</td> <td class="">'+standards[i]["cpu"]+'核</td> <td class="">'+standards[i]["memoryMB"]/1024+"GB</td></tr>"}else{currency_tr+='<tr class=""><td class=""><label><input type="radio" name="instancetype" value="'+standards[i]["instanceType"]+'">'+" "+pubobj[standards[i]["family"]]+'</label></td><td class="">'+standards[i]["instanceType"]+'</td> <td class="">'+standards[i]["cpu"]+'核</td> <td class="">'+standards[i]["memoryMB"]/1024+"GB</td></tr>"}}else{if(standards[i]["family"]=="c.n"){if(standards[i]["state"][0]["inStock"]==false){calculate_tr+='<tr class=""><td class=""><label><input type="radio" name="instancetype" disabled value="'+standards[i]["instanceType"]+'"> 计算优化 标准型<span class="label label-default">售罄</span></label></td><td class="">'+standards[i]["instanceType"]+'</td> <td class="">'+standards[i]["cpu"]+'核</td> <td class="">'+standards[i]["memoryMB"]/1024+"GB</td></tr>"}else{calculate_tr+='<tr class=""><td class=""><label><input type="radio" name="instancetype" value="'+standards[i]["instanceType"]+'"> 计算优化 标准型</label></td><td class="">'+standards[i]["instanceType"]+'</td> <td class="">'+standards[i]["cpu"]+'核</td> <td class="">'+standards[i]["memoryMB"]/1024+"GB</td></tr>"}}else{if(standards[i]["family"]=="m.n"){if(standards[i]["state"][0]["inStock"]==false){memory_tr+='<tr class=""><td class=""><label><input type="radio" name="instancetype" disabled value="'+standards[i]["instanceType"]+'"> 内存优化 标准型<span class="label label-default">售罄</span></label></td><td class="">'+standards[i]["instanceType"]+'</td> <td class="">'+standards[i]["cpu"]+'核</td> <td class="">'+standards[i]["memoryMB"]/1024+"GB</td></tr>"}else{memory_tr+='<tr class=""><td class=""><label><input type="radio" name="instancetype" value="'+standards[i]["instanceType"]+'"> 内存优化 标准型</label></td><td class="">'+standards[i]["instanceType"]+'</td> <td class="">'+standards[i]["cpu"]+'核</td> <td class="">'+standards[i]["memoryMB"]/1024+"GB</td></tr>"}}}}}}$(".currency").html(currency_tr);$(".calculate").html(calculate_tr);$(".memory").html(memory_tr);$(".spadding-td").hide();$(".currency").children("tr").find("td").eq(0).find("input").attr("checked",true);var stardtype=$(".currency").children("tr").eq(0).children("td").eq(0).text();var standard=$(".currency").children("tr").eq(0).children("td").eq(1).text();var cpunum=$(".currency").children("tr").eq(0).children("td").eq(2).text();var ram=$(".currency").children("tr").eq(0).children("td").eq(3).text();$(".standardp").html("当前当前选择实例：<span style='color: #ff9600;'>"+standard+"("+cpunum+ram+","+stardtype+")</span>");getconflist(0);$("input[name='instancetype']").click(function(){var stardtype=$(this).closest("tr").children("td").eq(0).text();
var standard=$(this).closest("tr").children("td").eq(1).text();var cpunum=$(this).closest("tr").children("td").eq(2).text();var ram=$(this).closest("tr").children("td").eq(3).text();var html="当前当前选择实例：<span style='color: #ff9600;'>"+standard+"("+cpunum+ram+","+stardtype+")</span>";$(".standardp").html(html);getconflist(0)})})};var totalprice;var getconflist=function(isbuy){var local=$(".localul").find(".onthis").text();var area=$(".areaul").find(".onthis").text();var image=$(".sel-images").children("option:selected").text();var standard=$(".standardp").find("span").text();var systemdisk=$(".sel-systemdisk").children("option:selected").text();var datadisk="";var gxpan=0;var ssdpan=0;var gxpannum="";var ssdpannum="";var gxpanpn="";var ssdpanpn="";$(".addssd").each(function(){var val=$(this).find(".sel-cloudpan").children("option:selected").val();if(val=="0"){gxpan+=1;gxpannum+=$(this).find(".pannum").val()+"GB、";gxpanpn+=$(this).find(".pannum").val()+","}else{ssdpan+=1;ssdpannum+=$(this).find(".pannum").val()+"GB、";ssdpanpn+=$(this).find(".pannum").val()+","}});gxpannum=gxpannum.substring(0,gxpannum.length-1);gxpanpn=gxpanpn.substring(0,gxpanpn.length-1);ssdpannum=ssdpannum.substring(0,ssdpannum.length-1);ssdpanpn=ssdpanpn.substring(0,ssdpanpn.length-1);if(gxpan!=0){datadisk+=gxpan+"个高效云盘("+gxpannum+")"}else{datadisk+=""}if(ssdpan!=0){datadisk+=ssdpan+"个SSD云盘("+ssdpannum+")"}else{datadisk+=""}var privatenet=$(".sel-privatenet").children("option:selected").val();var subnet=$(".sel-subnet").children("option:selected").val();var publicnetip="";var provider=$(".bgpul").find(".onthis").text();var bdval=$(".port").val();if($(".bybd").hasClass("onthis")){publicnetip+=provider+"按带宽"+bdval+"Mbps"}else{publicnetip+=provider+"按流量"+bdval+"Mbps"}var duration=$(".durul").find(".onthis").text();var buynum=$(".buynum").val();$(".p-config").html("<span>地域：</span>"+local+" <span>可用区：</span>"+area+" <span>镜像:</span>"+image+" <span>规格：</span>"+standard+" <span>系统盘：</span>"+systemdisk+" <span>数据盘：</span>"+datadisk+" <span>私有网络：</span>"+privatenet+" <span>子网：</span>"+subnet+" <span>公网IP：</span>"+publicnetip+" <span>购买时长：</span>"+duration+" <span>购买数量：</span>"+buynum);var formdata=$(".mform").serialize()+"&instancetype="+$("input[name='instancetype']:checked").val()+"&highpan="+gxpanpn+"&ssdpan="+ssdpanpn+"&imagename="+image;if(isbuy==0){$(".totalprice").text("价格计算中...");$.post("getprice",formdata,function(data,status){if(status="success"){$(".totalprice").text(data);totalprice=data}else{$(".totalprice").text("价格获取失败！")}})}else{formdata+="&totalprice="+totalprice+"&imagename="+image;var regex=new RegExp("^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-ZW_!@#$%^&*`~()-+=]+$)(?![a-z0-9]+$)(?![a-zW_!@#$%^&*`~()-+=]+$)(?![0-9W_!@#$%^&*`~()-+=]+$)[a-zA-Z0-9W_!@#$%^&*`~()-+=]{8,30}$");if($(".sel-images").children("option:selected").val()==""){layer.msg("请选择镜像",{time:1000})}else{if($(".servername").val().length>32||$(".servername").val().length==""){layer.msg("名称不能为空且不能超过32个字符！");$(".servername").css("border-color","red")}else{if($("input[name='issetpsw']:checked").val()=="1"){if($(".setpsw").val().length<8||$(".setpsw").val().length>30||!regex.test($(".setpsw").val())){layer.msg("请输入8至30位字符密码，且必须包含大写字母、小写字母、数字以及特殊符号其中三类！",{time:2000});$(".setpsw").css("border-color","red")}else{if($(".setpsw").val()!=$(".pswconfig").val()){layer.msg("两次输入密码不一致！",{time:1000});$(".pswconfig").css("border-color","red")}else{$(".servername .setpsw .setpsw").css("border-color","");$.post("buynow",formdata,function(data,status){layer.closeAll();$(".buybtn").attr("disabled",false);if(data==0){layer.msg("创建成功",{"icon":1})}else{if(data==1){layer.msg("ip绑定失败，请联系管理员处理！",{"icon":2})}else{layer.msg(data,{"icon":2})}}})}}}else{$(".buybtn").attr("disabled",true);$.post("buynow",formdata,function(data,status){layer.closeAll();$(".buybtn").attr("disabled",false);if(data==0){layer.msg("创建成功",{"icon":1})}else{if(data==1){layer.msg("ip绑定失败，请联系管理员处理！",{"icon":2})}else{if(data==2){layer.msg("无可用ip，联系管理员处理!",{"icon":2})}else{layer.msg(data,{"icon":0})}}}})}}}}};var init=function(){$(".list").find("ul:eq(0)").find("li:eq(0)").addClass("onthis");getimagelist()};init();$(".list ul li").click(function(){onthis($(this))});$(".otherul li").click(function(){getconflist(0)});$(".localul").children("li").click(function(){$(".areaul").find(".onthis").removeClass("onthis");$(".areaul").children("li").eq(0).addClass("onthis");if($(this).index()==0||$(this).index()==3){$(".areaul").children("li").eq(1).show()}else{$(".areaul").children("li").eq(1).hide()}if($(this).index()!=1){$(".bgpul").children("li").eq(1).hide()}else{$(".bgpul").children("li").eq(1).show()}getimagelist()});$(".single-slider").jRange({from:1,to:200,step:1,scale:[1,50,100,150,200],format:"%s",width:500,showLabels:true,showScale:true});$(".demo").mouseup(function(){setTimeout(function(){var port=$(".port").val();var minport=$(".port").data("minval");if(port<minport){window.location.reload()}getconflist(0)},500)});$("#mainTab li").click(function(){$("#mainTab").children("li").removeClass("active");
$(this).addClass("active");getconflist(0)});$(".imagetypeul li").click(function(){if($(this).index()==3){$(".sel-os").hide();$(".sel-images").addClass("ml130")}else{$(".sel-os").show();$(".sel-images").removeClass("ml130")}getimagelist()});$(".sel-os").change(function(){getimagelist()});$(".sel-images").change(function(){getconflist(0)});$(".resetimg").click(function(){$(".addssd").remove();$(".addpan").css({"cursor":"","color":""});getconflist(0)});$(".sel-netip").change(function(){var val=$(this).children("option:selected").val();switch(val){case"auto":$(".autoip,.autop").show();$(".customip,.customp").hide();break;case"custom":$(".autoip,.autop").hide();$(".customip,.customp").show();break}});$("input[name='issetpsw']").click(function(){var val=$(this).val();var regex=new RegExp("^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-ZW_!@#$%^&*`~()-+=]+$)(?![a-z0-9]+$)(?![a-zW_!@#$%^&*`~()-+=]+$)(?![0-9W_!@#$%^&*`~()-+=]+$)[a-zA-Z0-9W_!@#$%^&*`~()-+=]{8,30}$");switch(val){case"1":$(".inp-psd,.inp-repsd").show();break;case"0":$(".inp-psd,.inp-repsd").hide();break}});$(".addpan").click(function(){var ssdnum=0;$(".addssd").each(function(){ssdnum+=1});if(ssdnum<4){$(".panlist").append('<div class="addssd ml130"><select class="form-control sel-cloudpan"><option value="0">高效云盘</option><option value="1">SSD云盘</option></select><input type="text" class="form-control pannum changessd" style="position: relative;bottom: 2px;" placeholder="20-3000"> GB <span class="ml20" title="数据盘设备名范围：/dev/vdb--/dev/vdh。">自动分配设备名</span><a href="javascript:void(0)" class="ml20">使用快照创建</a><a href="javascript:void(0)" class="ml20 delpan" style="font-size: 16px;"><i class="fa fa-trash-o"></i></a></div>')}else{$(".addpan").css({"cursor":"not-allowed","color":"#ccc"})}$(".delpan").click(function(){$(".addpan").css({"cursor":"","color":""});$(this).closest(".addssd").remove();getconflist(0)});$(".changessd").change(function(){if($(this).val()%10!=0){$(this).val((parseInt($(this).val()/10)+1)*10)}if($(this).val()<20){$(this).val("20")}if($(this).val()>1000){$(this).val("1000")}getconflist(0)});$(".sel-cloudpan").change(function(){getconflist(0)});getconflist(0)});$(".servername").blur(function(){if($(this).val().length>32||$(this).val().length==""){layer.msg("名称不能为空且不能超过32个字符！");$(this).css("border-color","red")}else{$(this).css("border-color","")}});$(".setpsw").blur(function(){var val=$(this).val();if(val.length<8||val.length>30){layer.msg("请输入8至30位字符密码！");$(this).css("border-color","red")}else{$(this).css("border-color","")}});$(".pswconfig").blur(function(){var setpswval=$(".setpsw").val();var configval=$(this).val();if(configval!=setpswval){layer.msg("两次输入的密码不一致！");$(this).css("border-color","red")}else{$(this).css("border-color","")}});var incandred=function(obj,type,num,max){var thisval=obj.closest(".contain").find("input").val();var min=obj.closest(".contain").find("input").data("min");thisval=parseInt(thisval);if(type==1){if(thisval<max){thisval=thisval+num;obj.closest(".contain").find("input").val(thisval);obj.closest(".lanwrap").find(".bval").text(thisval);obj.closest(".contain").find("span").removeClass("dsb")}else{obj.addClass("dsb")}}else{if(thisval>min){thisval=thisval-num;obj.closest(".contain").find("input").val(thisval);obj.closest(".lanwrap").find(".bval").text(thisval);obj.closest(".contain").find("span").removeClass("dsb")}else{obj.addClass("dsb")}}};$(".updown .increase").click(function(){incandred($(this),1,1,10);getconflist(0)});$(".updown .reduce").click(function(){incandred($(this),0,1,10);getconflist(0)});$(".contain input").blur(function(){var val=$(this).val();if(val>10){$(this).val("10")}else{if(val<1){$(this).val("1")}}getconflist(0)});$(".buybtn").click(function(){layer.msg("请稍等",{icon:16,shade:0.01,time:20000});getconflist(1)})});function chstandard(param){switch(param){case 0:$(".currency").show();$(".calculate,.memory").hide();break;case 1:$(".calculate").show();$(".currency,.memory").hide();break;case 2:$(".memory").show();$(".currency,.calculate").hide();break}}function bdcost(param){switch(param){case 0:$(".bdcostp").hide();break;case 1:$(".bdcostp").show();break}};